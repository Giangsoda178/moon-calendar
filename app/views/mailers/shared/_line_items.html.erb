<%# Usage: render "mailers/shared/line_items", items: [{ description: "...", qty: 1, price: "$10", total: "$10" }] %>
<%# Optional: subtotal: "$90", tax: "$9", total: "$99", show_qty: true (default true) %>
<%
  items = local_assigns[:items] || []
  show_qty = local_assigns.fetch(:show_qty, true)
  subtotal = local_assigns[:subtotal]
  tax = local_assigns[:tax]
  total = local_assigns[:total]

  # Column widths based on whether qty column is shown
  if show_qty
    desc_width = "50%"
    qty_width = "15%"
    price_width = "17.5%"
    total_width = "17.5%"
  else
    desc_width = "65%"
    price_width = "17.5%"
    total_width = "17.5%"
  end
%>
<table role="presentation" cellpadding="0" cellspacing="0" width="100%"
       style="border-collapse: collapse; border-top: 1px solid <%= email_colors[:border] %>;">
  <!-- Header Row -->
  <tr>
    <td style="width: <%= desc_width %>; padding: 12px 0; font-weight: 600; font-size: 12px; color: <%= email_colors[:muted_foreground] %>; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
      Description
    </td>
    <% if show_qty %>
    <td style="width: <%= qty_width %>; text-align: right; padding: 12px 0; font-weight: 600; font-size: 12px; color: <%= email_colors[:muted_foreground] %>; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
      Qty
    </td>
    <% end %>
    <td style="width: <%= price_width %>; text-align: right; padding: 12px 0; font-weight: 600; font-size: 12px; color: <%= email_colors[:muted_foreground] %>; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
      Price
    </td>
    <td style="width: <%= total_width %>; text-align: right; padding: 12px 0; font-weight: 600; font-size: 12px; color: <%= email_colors[:muted_foreground] %>; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
      Total
    </td>
  </tr>

  <!-- Item Rows -->
  <% items.each do |item| %>
  <tr>
    <td style="padding: 12px 0; color: <%= email_colors[:foreground] %>; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      <%= item[:description] %>
      <% if item[:subtitle] %>
        <div style="font-size: 12px; color: <%= email_colors[:muted_foreground] %>; margin-top: 2px;"><%= item[:subtitle] %></div>
      <% end %>
    </td>
    <% if show_qty %>
    <td style="text-align: right; padding: 12px 0; color: <%= email_colors[:foreground] %>; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      <%= item[:qty] || 1 %>
    </td>
    <% end %>
    <td style="text-align: right; padding: 12px 0; color: <%= email_colors[:foreground] %>; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      <%= item[:price] %>
    </td>
    <td style="text-align: right; padding: 12px 0; color: <%= email_colors[:foreground] %>; border-bottom: 1px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      <%= item[:total] %>
    </td>
  </tr>
  <% end %>

  <!-- Summary Rows -->
  <% if subtotal %>
  <tr>
    <td colspan="<%= show_qty ? 3 : 2 %>" style="padding: 12px 0; text-align: right; color: <%= email_colors[:muted_foreground] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      Subtotal
    </td>
    <td style="text-align: right; padding: 12px 0; color: <%= email_colors[:foreground] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      <%= subtotal %>
    </td>
  </tr>
  <% end %>

  <% if tax %>
  <tr>
    <td colspan="<%= show_qty ? 3 : 2 %>" style="padding: 8px 0; text-align: right; color: <%= email_colors[:muted_foreground] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      Tax
    </td>
    <td style="text-align: right; padding: 8px 0; color: <%= email_colors[:foreground] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 14px;">
      <%= tax %>
    </td>
  </tr>
  <% end %>

  <% if total %>
  <tr>
    <td colspan="<%= show_qty ? 3 : 2 %>" style="padding: 12px 0; text-align: right; font-weight: 600; color: <%= email_colors[:foreground] %>; border-top: 2px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 16px;">
      Total
    </td>
    <td style="text-align: right; padding: 12px 0; font-weight: 600; color: <%= email_colors[:primary] %>; border-top: 2px solid <%= email_colors[:border] %>; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 18px;">
      <%= total %>
    </td>
  </tr>
  <% end %>
</table>
